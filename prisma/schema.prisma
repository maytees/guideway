// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
    provider = "prisma-client-js"
}

datasource db {
    provider = "postgresql"
    // NOTE: When using mysql or sqlserver, uncomment the @db.Text annotations in model Account below
    // Further reading:
    // https://next-auth.js.org/adapters/prisma#create-the-prisma-schema
    // https://www.prisma.io/docs/reference/api-reference/prisma-schema-reference#string
    url      = env("DATABASE_URL")
}

enum ClubCategory {
    ACADEMIC
    ARTS_AND_CULTURE
    BUSINESS_AND_ENTREPRENEURSHIP
    COMMUNITY_SERVICE_AND_VOLUNTEERING
    ENVIRONMENTAL_AND_SUSTAINABILITY
    HEALTH_AND_WELLNESS
    HOBBIES_AND_INTERESTS
    IDENTITY_AND_DIVERSITY
    MEDIA_AND_JOURNALISM
    POLITICAL_AND_ACTIVISM
    RELIGIOUS_AND_SPIRITUAL
    SOCIAL_AND_NETWORKING
    SPORTS_AND_RECREATION
    TECHNOLOGY_AND_INNOVATION
}

model Group {
    id           String       @id @default(cuid())
    name         String
    description  String
    category     ClubCategory
    created_at   DateTime     @default(now())
    updated_at   DateTime     @default(now())
    owner        User         @relation("GroupOwner", fields: [owner_id], references: [id])
    owner_id     String       @unique
    members      User[]       @relation("GroupMembers")
    logo         String?
    website      String?
    email        String?
    member_count Int
    posts        Post[]
}

model Post {
    id             Int       @id @default(autoincrement())
    title          String
    content        String
    created_at     DateTime  @default(now())
    updated_at     DateTime  @default(now())
    author         User      @relation(fields: [author_id], references: [id])
    author_id      String    @map("author_id")
    club           Group     @relation(fields: [club_id], references: [id])
    club_id        String    @map("club_id")
    likes          Like[]
    comments       Comment[]
    isAnnouncement Boolean   @default(false)
    isDraft        Boolean   @default(false)
    isPinned       Boolean   @default(false)
    viewCount      Int       @default(0)
    shareCount     Int       @default(0)
}

model Comment {
    id         Int           @id @default(autoincrement())
    content    String
    created_at DateTime      @default(now())
    updated_at DateTime      @default(now())
    author_id  String        @map("author_id")
    author     User          @relation(fields: [author_id], references: [id])
    post       Post          @relation(fields: [post_id], references: [id])
    post_id    Int           @map("post_id")
    likes      CommentLike[]
}

model Like {
    id         Int      @id @default(autoincrement())
    created_at DateTime @default(now())
    user_id    String   @map("user_id")
    user       User     @relation(fields: [user_id], references: [id])
    post_id    Int      @map("post_id")
    post       Post     @relation(fields: [post_id], references: [id])

    @@unique([user_id, post_id])
}

model CommentLike {
    id         Int      @id @default(autoincrement())
    created_at DateTime @default(now())
    user_id    String   @map("user_id")
    user       User     @relation(fields: [user_id], references: [id])
    comment_id Int
    comment    Comment  @relation(fields: [comment_id], references: [id])

    @@unique([user_id, comment_id])
}

model User {
    id                    String                 @id @default(cuid())
    name                  String?                @unique // This is required due to OAuth usernames
    email                 String?                @unique
    emailVerified         DateTime?
    phone                 String?                @unique
    image                 String?
    password              String?
    isTwoFactorEnabled    Boolean                @default(false)
    twoFactorConfirmation TwoFactorConfirmation?
    Session               Session[]

    google_id String? @unique

    Post        Post[]
    Comment     Comment[]
    Like        Like[]
    CommentLike CommentLike[]

    ownedGroups Group?  @relation("GroupOwner")
    groups      Group[] @relation("GroupMembers")
}

model Session {
    id        String   @id
    userId    String
    expiresAt DateTime
    user      User     @relation(references: [id], fields: [userId], onDelete: Cascade)
}

model VerificationToken {
    id      String   @id @default(cuid())
    email   String
    token   String   @unique
    expires DateTime

    @@unique([email, token])
}

model PasswordResetToken {
    id      String   @id @default(cuid())
    email   String
    token   String   @unique
    expires DateTime

    @@unique([email, token])
}

model TwoFactorToken {
    id      String   @id @default(cuid())
    email   String
    token   String   @unique
    expires DateTime

    @@unique([email, token])
}

model TwoFactorConfirmation {
    id String @id @default(cuid())

    userId String
    user   User   @relation(fields: [userId], references: [id], onDelete: Cascade)

    @@unique([userId])
}

model UpdatesUser {
    id        String @id @default(cuid())
    email     String @unique
    firstName String
}
